local UltraLordLib = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local Config = {
    Theme = {
        Primary = Color3.fromRGB(36, 36, 36),
        Secondary = Color3.fromRGB(46, 46, 46),
        Accent = Color3.fromRGB(240, 240, 240),
        Success = Color3.fromRGB(56, 207, 137),
        Error = Color3.fromRGB(229, 57, 53),
        Highlight = Color3.fromRGB(61, 133, 224)
    },
    Fonts = {
        Title = Enum.Font.GothamBold,
        Text = Enum.Font.Gotham,
        Button = Enum.Font.GothamMedium
    },
    Animation = {
        Short = 0.15,
        Normal = 0.3,
        Long = 0.5
    },
    MenuToggle = {
        Size = UDim2.new(0, 40, 0, 40),
        Position = UDim2.new(0, 10, 0.5, -20),
        Image = "rbxassetid://11432851457",
        Transparency = 0.1,
        HoverTransparency = 0
    }
}

-- Utility functions
local function Tween(object, duration, properties)
    local tween = TweenService:Create(object, TweenInfo.new(duration), properties)
    tween:Play()
    return tween
end

local function CreateElement(className, properties)
    local element = Instance.new(className)
    for prop, value in pairs(properties) do
        element[prop] = value
    end
    return element
end

function UltraLordLib:Notify(options)
    local title = options.Title or "Notification"
    local message = options.Message or ""
    local duration = options.Duration or 3

    local gui = CreateElement("ScreenGui", {
        Name = "UltraLordNotification",
        Parent = game.CoreGui
    })

    local frame = CreateElement("Frame", {
        Name = "NotificationFrame",
        Parent = gui,
        BackgroundColor3 = Config.Theme.Primary,
        Position = UDim2.new(1, 20, 0.8, 0),
        Size = UDim2.new(0, 250, 0, 80),
        BackgroundTransparency = 1
    })

    local corner = CreateElement("UICorner", {
        Parent = frame,
        CornerRadius = UDim.new(0, 6)
    })

    local titleLabel = CreateElement("TextLabel", {
        Parent = frame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 5),
        Size = UDim2.new(1, -20, 0, 25),
        Font = Config.Fonts.Title, -- Using new font
        Text = title,
        TextColor3 = Config.Theme.Accent,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTransparency = 1
    })

    local messageLabel = CreateElement("TextLabel", {
        Parent = frame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 35),
        Size = UDim2.new(1, -20, 0, 35),
        Font = Config.Fonts.Text, -- Using new font
        Text = message,
        TextColor3 = Config.Theme.Accent,
        TextSize = 14,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTransparency = 1
    })

    -- Animation handler
    coroutine.wrap(function()
        Tween(frame, Config.Animation.Normal, { -- Using new animation duration
            Position = UDim2.new(1, -270, 0.8, 0),
            BackgroundTransparency = 0
        })

        Tween(titleLabel, Config.Animation.Normal, { -- Using new animation duration
            TextTransparency = 0
        })

        Tween(messageLabel, Config.Animation.Normal, {  -- Using new animation duration
            TextTransparency = 0
        })

        wait(duration)

        Tween(frame, Config.Animation.Normal, { -- Using new animation duration
            Position = UDim2.new(1, 20, 0.8, 0),
            BackgroundTransparency = 1
        })

        Tween(titleLabel, Config.Animation.Normal, { -- Using new animation duration
            TextTransparency = 1
        })

        Tween(messageLabel, Config.Animation.Normal, { -- Using new animation duration
            TextTransparency = 1
        }).Completed:Wait()

        gui:Destroy()
    end)()
end

function UltraLordLib:CreateWindow(options)
    local windowConfig = {
        Title = options.Title or "Ultra Lord V3",
        Theme = options.Theme or {},
        Fonts = options.Fonts or {}
    }

    -- Merge custom theme with default
    for key, value in pairs(windowConfig.Theme) do
        Config.Theme[key] = value
    end

    -- Merge custom fonts with default
    for key, value in pairs(windowConfig.Fonts) do
        Config.Fonts[key] = value
    end

    local ScreenGui = CreateElement("ScreenGui", {
        Name = "UltraLordV3",
        Parent = game.CoreGui,
        ResetOnSpawn = false
    })

    local Main = CreateElement("Frame", {
        Name = "Main",
        Parent = ScreenGui,
        BackgroundColor3 = Config.Theme.Primary,
        Position = UDim2.new(0.5, -300, 0.5, -175),
        Size = UDim2.new(0, 600, 0, 350),
        ClipsDescendants = true
    })

    -- Menu Toggle Button
    local MenuToggle = CreateElement("ImageButton", {
        Name = "MenuToggle",
        Parent = ScreenGui,
        BackgroundColor3 = Config.Theme.Primary,
        Position = Config.MenuToggle.Position,
        Size = Config.MenuToggle.Size,
        Image = Config.MenuToggle.Image,
        BackgroundTransparency = Config.MenuToggle.Transparency,
        ImageTransparency = Config.MenuToggle.Transparency
    })

    CreateElement("UICorner", {
        Parent = MenuToggle,
        CornerRadius = UDim.new(0, 8)
    })

    -- Window shadow and effects
    local Shadow = CreateElement("ImageLabel", {
        Name = "Shadow",
        Parent = Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, -15, 0, -15),
        Size = UDim2.new(1, 30, 1, 30),
        Image = "rbxassetid://6015897843",
        ImageColor3 = Color3.new(0, 0, 0),
        ImageTransparency = 0.5,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })

    -- Title bar with new font
    local TitleBar = CreateElement("Frame", {
        Name = "TitleBar",
        Parent = Main,
        BackgroundColor3 = Config.Theme.Secondary,
        Size = UDim2.new(1, 0, 0, 40)
    })

    local Title = CreateElement("TextLabel", {
        Parent = TitleBar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 15, 0, 0),
        Size = UDim2.new(1, -30, 1, 0),
        Font = Config.Fonts.Title,
        Text = windowConfig.Title,
        TextColor3 = Config.Theme.Accent,
        TextSize = 18,
        TextXAlignment = Enum.TextXAlignment.Left
    })

    -- Make window draggable with smoother dragging
    local isDragging = false
    local dragStart = nil
    local startPos = nil

    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = true
            dragStart = input.Position
            startPos = Main.Position
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if isDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            isDragging = false
        end
    end)

    -- Menu Toggle functionality
    local isMenuVisible = true
    MenuToggle.MouseButton1Click:Connect(function()
        isMenuVisible = not isMenuVisible
        if isMenuVisible then
            Main.Visible = true
            Tween(Main, Config.Animation.Normal, {
                Position = UDim2.new(0.5, -300, 0.5, -175)
            })
        else
            Tween(Main, Config.Animation.Normal, {
                Position = UDim2.new(1.5, 0, 0.5, -175)
            }).Completed:Wait()
            Main.Visible = false
        end
    end)

    -- Hover effects for menu toggle
    MenuToggle.MouseEnter:Connect(function()
        Tween(MenuToggle, Config.Animation.Short, {
            BackgroundTransparency = Config.MenuToggle.HoverTransparency,
            ImageTransparency = Config.MenuToggle.HoverTransparency
        })
    end)

    MenuToggle.MouseLeave:Connect(function()
        Tween(MenuToggle, Config.Animation.Short, {
            BackgroundTransparency = Config.MenuToggle.Transparency,
            ImageTransparency = Config.MenuToggle.Transparency
        })
    end)

    local TabHolder = CreateElement("Frame", {
        Name = "TabHolder",
        Parent = Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 10, 0, 40),
        Size = UDim2.new(0, 120, 0, 250)
    })

    local ContentHolder = CreateElement("Frame", {
        Name = "ContentHolder",
        Parent = Main,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 135, 0, 40),
        Size = UDim2.new(0, 355, 0, 250)
    })

    local TabList = CreateElement("UIListLayout", {
        Parent = TabHolder,
        SortOrder = Enum.SortOrder.LayoutOrder,
        Padding = UDim.new(0, 5)
    })

    local Window = {}
    local Tabs = {}

    function Window:AddTab(name)
        local tab = CreateElement("TextButton", {
            Name = name,
            Parent = TabHolder,
            BackgroundColor3 = Config.Theme.Secondary,
            Size = UDim2.new(1, 0, 0, 30),
            Text = name,
            TextColor3 = Config.Theme.Accent,
            Font = Config.Fonts.Button, -- Using new font
            TextSize = 14
        })

        CreateElement("UICorner", {
            Parent = tab,
            CornerRadius = UDim.new(0, 5)
        })

        local container = CreateElement("ScrollingFrame", {
            Name = name.."Container",
            Parent = ContentHolder,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            ScrollBarThickness = 4,
            Visible = false
        })

        CreateElement("UIListLayout", {
            Parent = container,
            SortOrder = Enum.SortOrder.LayoutOrder,
            Padding = UDim.new(0, 5)
        })

        local TabFunctions = {}

        function TabFunctions:AddButton(options)
            local button = CreateElement("TextButton", {
                Parent = container,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, -10, 0, 30),
                Text = options.Name,
                TextColor3 = Config.Theme.Accent,
                Font = Config.Fonts.Button, -- Using new font
                TextSize = 14
            })

            CreateElement("UICorner", {
                Parent = button,
                CornerRadius = UDim.new(0, 5)
            })

            button.MouseButton1Click:Connect(options.Callback)
            return button
        end

        function TabFunctions:AddToggle(options)
            local toggle = CreateElement("Frame", {
                Parent = container,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, -10, 0, 30)
            })

            local button = CreateElement("TextButton", {
                Parent = toggle,
                BackgroundTransparency = 1,
                Size = UDim2.new(1, 0, 1, 0),
                Text = options.Name,
                TextColor3 = Config.Theme.Accent,
                Font = Config.Fonts.Button, -- Using new font
                TextSize = 14
            })

            local status = CreateElement("Frame", {
                Parent = toggle,
                BackgroundColor3 = options.Default and Config.Theme.Success or Config.Theme.Error,
                Position = UDim2.new(1, -25, 0.5, -5),
                Size = UDim2.new(0, 10, 0, 10)
            })

            CreateElement("UICorner", {
                Parent = status,
                CornerRadius = UDim.new(1, 0)
            })

            local enabled = options.Default or false
            button.MouseButton1Click:Connect(function()
                enabled = not enabled
                status.BackgroundColor3 = enabled and Config.Theme.Success or Config.Theme.Error
                options.Callback(enabled)
            end)

            return toggle
        end

        function TabFunctions:AddLabel(options)
            local label = CreateElement("TextLabel", {
                Parent = container,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, -10, 0, 30),
                Text = options.Text,
                TextColor3 = Config.Theme.Accent,
                Font = Config.Fonts.Text, -- Using new font
                TextSize = 14
            })

            CreateElement("UICorner", {
                Parent = label,
                CornerRadius = UDim.new(0, 5)
            })

            return label
        end

        function TabFunctions:AddParagraph(options)
            local paragraph = CreateElement("TextLabel", {
                Parent = container,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, -10, 0, 0),
                Text = options.Text,
                TextColor3 = Config.Theme.Accent,
                Font = Config.Fonts.Text, -- Using new font
                TextSize = 14,
                TextWrapped = true,
                AutomaticSize = Enum.AutomaticSize.Y,
                TextXAlignment = Enum.TextXAlignment.Left,
                TextYAlignment = Enum.TextYAlignment.Top,
                Padding = UDim.new(0, 10)
            })

            CreateElement("UIPadding", {
                Parent = paragraph,
                PaddingLeft = UDim.new(0, 10),
                PaddingRight = UDim.new(0, 10),
                PaddingTop = UDim.new(0, 10),
                PaddingBottom = UDim.new(0, 10)
            })

            CreateElement("UICorner", {
                Parent = paragraph,
                CornerRadius = UDim.new(0, 5)
            })

            return paragraph
        end

        function TabFunctions:AddSlider(options)
            local slider = CreateElement("Frame", {
                Parent = container,
                BackgroundColor3 = Config.Theme.Secondary,
                Size = UDim2.new(1, -10, 0, 45)
            })

            CreateElement("UICorner", {
                Parent = slider,
                CornerRadius = UDim.new(0, 5)
            })

            local title = CreateElement("TextLabel", {
                Parent = slider,
                BackgroundTransparency = 1,
                Position = UDim2.new(0, 10, 0, 0),
                Size = UDim2.new(1, -20, 0, 20),
                Text = options.Name,
                TextColor3 = Config.Theme.Accent,
                TextXAlignment = Enum.TextXAlignment.Left,
                Font = Config.Fonts.Text, -- Using new font
                TextSize = 14
            })

            local bar = CreateElement("Frame", {
                Parent = slider,
                BackgroundColor3 = Color3.fromRGB(50, 50, 50),
                Position = UDim2.new(0, 10, 0, 25),
                Size = UDim2.new(1, -20, 0, 5)
            })

            local button = CreateElement("TextButton", {
                Parent = bar,
                BackgroundColor3 = Config.Theme.Accent,
                Size = UDim2.new(0, 10, 0, 15),
                Position = UDim2.new(0, -5, 0.5, -7.5),
                Text = ""
            })

            local value = CreateElement("TextLabel", {
                Parent = slider,
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -40, 0, 0),
                Size = UDim2.new(0, 30, 0, 20),
                Text = tostring(options.Default or options.Min),
                TextColor3 = Config.Theme.Accent,
                Font = Config.Fonts.Text, -- Using new font
                TextSize = 14
            })

            local function update(input)
                local pos = UDim2.new(
                    math.clamp(
                        (input.Position.X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X,
                        0,
                        1
                    ),
                    -5,
                    0.5,
                    -7.5
                )
                button.Position = pos
                local val = math.floor(((pos.X.Scale * (options.Max - options.Min)) + options.Min) * 100) / 100
                value.Text = tostring(val)
                options.Callback(val)
            end

            button.MouseButton1Down:Connect(function()
                local connection
                connection = UserInputService.InputChanged:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseMovement then
                        update(input)
                    end
                end)

                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 then
                        if connection then
                            connection:Disconnect()
                        end
                    end
                end)
            end)

            return slider
        end

        tab.MouseButton1Click:Connect(function()
            for _, t in pairs(TabHolder:GetChildren()) do
                if t:IsA("TextButton") then
                    Tween(t, Config.Animation.Short, {  -- Using new animation duration
                        BackgroundColor3 = t == tab and Config.Theme.Accent or Config.Theme.Secondary,
                        TextColor3 = t == tab and Config.Theme.Primary or Config.Theme.Accent
                    })
                end
            end

            for _, c in pairs(ContentHolder:GetChildren()) do
                if c:IsA("ScrollingFrame") then
                    if c == container then
                        c.Visible = true
                        c.Position = UDim2.new(1, 0, 0, 0)
                        Tween(c, Config.Animation.Normal, { -- Using new animation duration
                            Position = UDim2.new(0, 0, 0, 0)
                        })
                    else
                        Tween(c, Config.Animation.Normal, { -- Using new animation duration
                            Position = UDim2.new(-1, 0, 0, 0)
                        }).Completed:Connect(function()
                            c.Visible = false
                        end)
                    end
                end
            end
        end)

        if #TabHolder:GetChildren() == 1 then
            tab.BackgroundColor3 = Config.Theme.Accent
            tab.TextColor3 = Config.Theme.Primary
            container.Visible = true
        end

        return TabFunctions
    end

    return Window
end

return UltraLordLib
